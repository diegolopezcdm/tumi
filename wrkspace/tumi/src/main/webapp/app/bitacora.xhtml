<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/template/plantilla.xhtml">

	<ui:define name="content">
		<h:outputStylesheet library="css" name="main.css" />
		<h:outputScript name="jquery/jquery.js" library="primefaces"
			target="head" />

		<h3 class="hardblue TexAlCenter">Bitácora del sistema</h3>


		<div class="ContainerIndent">

			<p:panel>
				<div class="ContainerIndent">
					<h:form id="formTblBitacora">
						
						<p:dataTable id="tblBitacora" var="lazyModel"
							value="#{bitacoraBean.lazyModel}" paginator="true" rows="10"
							selectionMode="single"
							loadingmessage="Realizando la operación, por favor espere un momento..."
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							selection="#{bitacoraBean.selectedValue}" lazy="true"
							rowKey="#{lazyModel.id}" rowsPerPageTemplate="5,10,15,20"
							emptyMessage="No se encontro registros" reflow="true"
							widgetVar="w_tblBitacora">

							<p:ajax event="rowSelect" oncomplete="PF('w_dlgDetail').show();"
								update="form1" listener="#{bitacoraBean.onRowSelect(event)}" />

							<f:facet name="header">
                                Bitacora de procesos realizados 
                            </f:facet>

							<p:column headerText="Usuario">
								<h:outputText value="#{lazyModel.idUsuario.usuario}" />
							</p:column>

							<p:column headerText="Proceso" filterBy="#{lazyModel.proceso}"
								sortBy="#{lazyModel.proceso}">
								<h:outputText value="#{lazyModel.proceso}" />
							</p:column>

							<p:column headerText="Descripción">
								<div id="colbtn1" style="text-align: center">
									<p:commandButton update="formInfo" styleClass="btnInfo"
										oncomplete="PF('w_dlgInfo').show()" id="btnDetail"
										icon="fa icon-search Fs12 white" title="View">
										<f:setPropertyActionListener value="#{lazyModel}"
											target="#{bitacoraBean.selectedValue}" />
									</p:commandButton>
									<p:tooltip id="toolTipFade1" for="btnDetail"
										value="Consultar detalles del evento" trackMouse="true" />
								</div>
							</p:column>

							<p:column headerText="Fecha de proceso"
								filterBy="#{lazyModel.fechaProceso}"
								sortBy="#{lazyModel.fechaProceso}">
								<f:facet name="filter">
									<p:calendar pattern="dd-MM-yyyy">
										<p:ajax event="dateSelect" update="tblBitacora"
											oncomplete="PF('w_tblBitacora').filter()" />
										<p:ajax event="change" update="tblBitacora"
											oncomplete="PF('w_tblBitacora').filter()" />
									</p:calendar>
								</f:facet>
								<h:outputText value="#{lazyModel.fechaProceso}">
									<f:convertDateTime pattern="dd-MM-yyyy hh:mm a" />
								</h:outputText>
							</p:column>

						</p:dataTable>
					</h:form>
				</div>
			</p:panel>

			<div class="EmptyBox20"></div>

		</div>

		<p:dialog id="dlgInfo" header="Detalles del evento"
			widgetVar="w_dlgInfo" modal="true" resizable="false"
			styleClass="modal-body" closable="false" showEffect="fade"
			hideEffect="fade" responsive="true">

			<h:form id="formInfo">
				<div class="ui-g">

					<div class="ui-g-12 ui-md-12 ui-lg-12 ">
						<p:outputLabel id="inf0" styleClass="textParagraph"
							value="#{bitacoraBean.selectedValue.descripcion}" />
					</div>
				</div>

				<div class="ui-g">
					<div class="ui-g-12 ui-md-12 ui-lg-12 " style="text-align: center">
						<p:commandButton styleClass="btnClose" id="btnClose"
							value="Cerrar" oncomplete="PF('w_dlgInfo').hide();"
							icon="fa icon-cancel-circled Fs13 white" />
					</div>
				</div>
			</h:form>

		</p:dialog>

		<p:dialog id="dlgDetail" header="Detalle eventos"
			widgetVar="w_dlgDetail" closable="false" modal="true"
			resizable="false" showEffect="fade" hideEffect="fade"
			styleClass="modal-body" responsive="true">
			<h:form id="form1">
				<div class="ui-g">
					<div class="ui-g-12 ui-md-6 ui-lg-6 ">
						<p:outputLabel value="Usuario: " />
					</div>

					<div class="ui-g-12 ui-md-6 ui-lg-6 ">
						<p:outputLabel id="usrName"
							value="#{bitacoraBean.selectedValue.idUsuario.usuario}" />
					</div>
				</div>

				<div class="ui-g">
					<div class="ui-g-12 ui-md-6 ui-lg-6 " >
						<p:outputLabel value="Proceso: " />
					</div>
					<div class="ui-g">
						<div class="ui-g-12 ui-md-6 ui-lg-6 ">
							<p:outputLabel id="usrPswd"
								value="#{bitacoraBean.selectedValue.proceso}" />
						</div>
					</div>
				</div>

				<div class="ui-g">
					<div class="ui-g-12 ui-md-6 ui-lg-6 " >
						<p:outputLabel value="Descripcion: " />
					</div>

					<div class="ui-g-12 ui-md-6 ui-lg-6 ">
						<p:inputTextarea id="usrEst" style="width:100%;"
							value="#{bitacoraBean.selectedValue.descripcion}" />
					</div>
				</div>

				<div class="ui-g">
					<div class="ui-g-12 ui-md-6 ui-lg-6 " >
						<p:outputLabel value="Fecha de Proceso: " />
					</div>

					<div class="ui-g-12 ui-md-6 ui-lg-6 ">
						<p:outputLabel id="fchReg"
							value="#{bitacoraBean.selectedValue.fechaProceso}">
							<f:convertDateTime pattern="dd-MM-yyyy hh:mm a" />
						</p:outputLabel>
					</div>
				</div>
				<div class="ui-g">
					<div class="ui-g-12 ui-md-12 ui-lg-12 ">
						<p:commandButton styleClass="btnCancel" id="btnCancel"
							oncomplete="if (args &amp;&amp; !args.validationFailed) {PF('w_tblDetail).clearFilters();PF('w_dlgAdd').hide();}"
							value="Cerrar" actionListener="#{bitacoraBean.cancelar()}"
							icon="fa fa-times Fs15 white" update="form1" />
					</div>
				</div>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>